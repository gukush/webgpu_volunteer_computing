<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Framework Volunteer Computing</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; max-width: 1200px; margin: 0 auto; padding: 20px; line-height: 1.6; color: #333; }
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid #eee; }
        .container { display: flex; flex-wrap: wrap; gap: 20px; }
        .card { background: #fff; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); padding: 20px; flex: 1 0 300px; margin-bottom:20px; }
        .status { padding: 10px 15px; border-radius: 4px; margin-bottom: 15px; }
        .success { background-color: #d4edda; color: #155724; }
        .warning { background-color: #fff3cd; color: #856404; }
        .error { background-color: #f8d7da; color: #721c24; }
        .info { background-color: #d1ecf1; color: #0c5460; }
        button { padding: 10px 16px; background-color: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; margin-right: 10px; margin-top: 5px; }
        button:hover { background-color: #45a049; }
        button:disabled { background-color: #cccccc; cursor: not-allowed; }
        button.secondary { background-color: #2196F3; }
        button.secondary:hover { background-color: #0b7dda; }
        button.danger { background-color: #f44336; }
        button.danger:hover { background-color: #da190b; }
        button.enhanced { background-color: #9C27B0; }
        button.enhanced:hover { background-color: #7B1FA2; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 10px; margin-bottom: 20px; }
        .stat-box { background: #f9f9f9; padding: 15px; border-radius: 6px; text-align: center; border: 1px solid #eee; }
        .stat-value { font-size: 24px; font-weight: bold; margin: 5px 0; }
        .log-container { max-height: 300px; overflow-y: auto; background: #f8f8f8; padding: 10px; border-radius: 4px; font-family: monospace; margin-top: 15px; font-size: 0.9em; }
        .client-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 10px; margin-top: 15px; }
        .client-card { padding: 10px; border-radius: 6px; background: #f1f1f1; border-left: 4px solid #4CAF50; font-size: 0.9em; }
        .client-inactive { border-left-color: #999; opacity: 0.7; }
        .client-cpu { border-left-color: #ffc107; }
        .client-puppeteer { border-left-style: dashed; }
        #admin-panel { display: none; margin-top: 20px; padding: 20px; background: #f9f9f9; border-radius: 8px; border: 1px solid #ddd; }
        .admin-controls, .wgsl-controls { display: flex; flex-wrap: wrap; gap: 15px; margin-top: 15px; align-items: flex-end; }
        .admin-controls div, .wgsl-controls div, .wgsl-chunking-controls div, .enhanced-controls div { display: flex; flex-direction: column; }
        .admin-controls label, .wgsl-controls label, .wgsl-chunking-controls label, .enhanced-controls label { margin-bottom: 5px; font-size: 0.9em; }
        .admin-controls input, .admin-controls select, .wgsl-controls input, .wgsl-controls select, .wgsl-controls textarea,
        .wgsl-chunking-controls input, .wgsl-chunking-controls select, .enhanced-controls input, .enhanced-controls select, .enhanced-controls textarea { padding: 8px; border-radius: 4px; border: 1px solid #ccc; }
        .wgsl-controls textarea, .enhanced-controls textarea { min-height: 150px; font-family: monospace; width: 100%; }
        .wgsl-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 10px; margin-top: 15px; }
        .wgsl-card { padding: 15px; border-radius: 6px; background: #e9e9e9; font-size: 0.9em; display: flex; flex-direction: column; justify-content: space-between; }
        .wgsl-card h4 { margin-top:0; margin-bottom: 5px; }
        .wgsl-card pre { white-space: pre-wrap; word-break: break-all; max-height: 100px; overflow-y: auto; background: #fff; padding: 5px; border-radius: 3px;}
        .wgsl-card-actions { margin-top: 10px; text-align: right; }
        .wgsl-chunking-options { border: 1px dashed #ccc; padding: 15px; margin-top: 15px; border-radius: 4px; background-color: #fdfdfd;}
        .wgsl-chunking-options legend { font-weight: bold; padding: 0 5px; margin-left: 10px; color: #555;}
        .wgsl-chunking-controls, .enhanced-controls { display: flex; flex-wrap: wrap; gap: 15px; align-items: flex-end; }
        .client-card .status.info { font-size: 0.8em; padding: 2px 5px; border-radius: 3px; display: inline-block; margin-top:3px;}

        /* Enhanced chunking system styles */
        .enhanced-section { border: 2px solid #9C27B0; border-radius: 8px; padding: 20px; margin-top: 20px; background: linear-gradient(145deg, #f8f4ff, #fff); }
        .enhanced-section h3 { color: #9C27B0; margin-top: 0; }
        .strategy-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 15px; margin-top: 15px; }
        .strategy-card { padding: 15px; border-radius: 6px; background: #fff; border: 1px solid #ddd; font-size: 0.9em; }
        .strategy-card h4 { margin-top: 0; margin-bottom: 8px; color: #333; }
        .strategy-card .strategy-type { display: inline-block; padding: 2px 8px; background: #9C27B0; color: white; border-radius: 3px; font-size: 0.8em; margin-bottom: 8px; }
        .strategy-card .strategy-type.assembly { background: #FF5722; }
        .strategy-upload-section { background: #f0f8ff; padding: 15px; border-radius: 6px; margin-top: 15px; border: 1px dashed #2196F3; }
        .multi-input-section { background: #f8fff0; padding: 15px; border-radius: 6px; margin-top: 15px; border: 1px dashed #4CAF50; }

        /* Framework-specific styles */
        .framework-badge {
            display: inline-block; padding: 2px 6px; margin: 2px; background: #007bff; color: white;
            border-radius: 3px; font-size: 0.8em; font-weight: bold;
        }
        .framework-badge.webgpu { background: #4CAF50; }
        .framework-badge.webgl { background: #FF9800; }
        .framework-badge.cuda { background: #76B900; }
        .framework-badge.opencl { background: #FF5722; }
        .framework-badge.vulkan { background: #9C27B0; }

        .framework-options {
            border: 1px solid #ddd; padding: 15px; margin-top: 10px; border-radius: 4px;
            background-color: #fafafa; display: none;
        }
        .framework-options.active { display: block; }
        .framework-options h4 { margin-top: 0; color: #666; }

        .compilation-options {
            background: #f5f5f5; padding: 10px; border-radius: 4px; margin-top: 10px;
        }
        .compilation-options textarea {
            width: 100%; min-height: 80px; font-family: monospace; font-size: 0.9em;
        }

        /* Enhanced workload styles */
        .workload-status { display: inline-block; padding: 3px 8px; border-radius: 3px; font-size: 0.8em; color: white; }
        .workload-status.queued { background: #FF9800; }
        .workload-status.running { background: #2196F3; }
        .workload-status.complete { background: #4CAF50; }
        .workload-status.error { background: #f44336; }
        .workload-status.enhanced { background: #9C27B0; }

        .enhanced-workload-card { border-left: 4px solid #9C27B0; }
        .enhanced-workload-card .strategy-info { font-size: 0.8em; color: #666; margin-top: 5px; }
    </style>
</head>
<body>
    <header>
        <h1>Multi-Framework Volunteer Computing</h1>
        <div>
            <button id="toggle-admin" class="secondary">Admin Panel</button>
        </div>
    </header>
    <div class="status info" id="secure-context-status">Checking secure context...</div>
    <div class="status info" id="webgpu-status">Checking framework support...</div>

    <div class="container">
        <div class="card">
            <h2>Computation Status</h2>
            <div class="status info" id="computation-status">Connecting to server...</div>
            <div class="stats-grid">
                <div class="stat-box"><div>Active Clients</div><div class="stat-value" id="active-clients">0</div></div>
                <div class="stat-box"><div>Total Tasks</div><div class="stat-value" id="total-tasks">0</div></div>
                <div class="stat-box"><div>Completed</div><div class="stat-value" id="completed-tasks">0</div></div>
                <div class="stat-box"><div>Enhanced Tasks</div><div class="stat-value" id="enhanced-tasks">0</div></div>
                <div class="stat-box"><div>Elapsed Time</div><div class="stat-value" id="elapsed-time">0s</div></div>
            </div>
            <div>
                <button id="join-computation" disabled>Join Computation</button>
                <button id="leave-computation" disabled>Leave</button>
            </div>
            <div id="gpu-info" class="status info" style="margin-top: 15px;">GPU information will appear here</div>
            <div id="framework-info" class="status info" style="margin-top: 15px;">Framework capabilities will appear here</div>
        </div>

        <div class="card">
            <h2>My Task Status</h2>
            <div class="status info" id="task-status">No task assigned</div>
            <div class="stats-grid">
                <div class="stat-box"><div>My Tasks</div><div class="stat-value" id="my-tasks">0</div></div>
                <div class="stat-box"><div>Processing</div><div class="stat-value" id="processing-time">0ms</div></div>
                <div class="stat-box"><div>Framework</div><div class="stat-value" id="current-framework">-</div></div>
                <div class="stat-box"><div>Strategy</div><div class="stat-value" id="current-strategy">-</div></div>
            </div>
            <div class="log-container" id="task-log">Task activity will appear here...</div>
        </div>

        <div class="card">
            <h2>Network Status</h2>
            <div id="client-status" class="status info">Not connected</div>
            <h3>Connected Clients</h3>
            <div class="client-grid" id="client-grid"><div class="client-card">Loading clients...</div></div>
        </div>
    </div>

    <div id="admin-panel">
        <h2>Admin Control Panel</h2>

        <div class="card">
            <h3>Matrix Multiplication Computation</h3>
            <p>Start a new matrix multiplication computation:</p>
            <div class="admin-controls">
                <div><label for="matrix-size">Matrix Size:</label><select id="matrix-size"><option value="128">128x128</option><option value="256">256x256</option><option value="512" selected>512x512</option><option value="1024">1024x1024</option><option value="2048">2048x2048</option></select></div>
                <div><label for="chunk-size">Chunk Size (Matrix Rows):</label><select id="chunk-size"><option value="16">16 rows</option><option value="32" selected>32 rows</option><option value="64">64 rows</option><option value="128">128 rows</option></select></div>
                <button id="start-computation">Start Matrix Computation</button>
            </div>
            <div class="log-container" id="admin-log-matrix">Admin matrix actions will be logged here...</div>
        </div>

        <!-- Enhanced Chunking System Section -->
        <div class="enhanced-section">
            <h3>üöÄ Enhanced Chunking System</h3>

            <!-- Strategy Management -->
            <div class="card">
                <h4>Strategy Management</h4>
                <div style="display: flex; gap: 15px; margin-bottom: 15px;">
                    <button id="list-strategies-btn" class="enhanced">List Available Strategies</button>
                    <button id="refresh-strategies-btn" class="secondary">Refresh</button>
                </div>

                <div class="strategy-upload-section">
                    <h4>üìÅ Upload Custom Strategy</h4>
                    <div class="enhanced-controls">
                        <div>
                            <label for="strategy-type">Strategy Type:</label>
                            <select id="strategy-type">
                                <option value="chunking">Chunking Strategy</option>
                                <option value="assembly">Assembly Strategy</option>
                            </select>
                        </div>
                        <div>
                            <label for="strategy-name">Strategy Name:</label>
                            <input type="text" id="strategy-name" placeholder="e.g., my_custom_chunking">
                        </div>
                        <div style="flex-grow: 1;">
                            <label for="strategy-code">Strategy Code:</label>
                            <textarea id="strategy-code" placeholder="import { BaseChunkingStrategy } from '../../strategies/base/BaseChunkingStrategy.js';

export default class MyCustomStrategy extends BaseChunkingStrategy {
  constructor() {
    super('my_custom_strategy');
  }

  planExecution(workload) {
    // Implementation here
  }

  createChunkDescriptors(plan) {
    // Implementation here
  }
}" rows="12"></textarea>
                        </div>
                        <button id="upload-strategy-btn" class="enhanced">Upload Strategy</button>
                    </div>
                </div>

                <div id="available-strategies" class="strategy-grid">
                    <div class="strategy-card">
                        <div class="strategy-type">chunking</div>
                        <h4>Loading strategies...</h4>
                        <p>Click "List Available Strategies" to load</p>
                    </div>
                </div>
                <div class="log-container" id="admin-log-strategies">Strategy management actions will be logged here...</div>
            </div>

            <!-- Enhanced Tiled Matrix -->
            <div class="card">
                <h4>üî≤ Enhanced Tiled Matrix Multiplication</h4>
                <p>Advanced matrix multiplication with pluggable tiling strategies:</p>
                <div class="enhanced-controls">
                    <div>
                        <label for="enhanced-matrix-size">Matrix Size:</label>
                        <select id="enhanced-matrix-size">
                            <option value="256">256√ó256</option>
                            <option value="512" selected>512√ó512</option>
                            <option value="1024">1024√ó1024</option>
                            <option value="2048">2048√ó2048</option>
                            <option value="4096">4096√ó4096</option>
                        </select>
                    </div>
                    <div>
                        <label for="tile-size">Tile Size:</label>
                        <select id="tile-size">
                            <option value="32">32√ó32</option>
                            <option value="64" selected>64√ó64</option>
                            <option value="128">128√ó128</option>
                            <option value="256">256√ó256</option>
                        </select>
                    </div>
                    <div>
                        <label for="enhanced-matrix-label">Label:</label>
                        <input type="text" id="enhanced-matrix-label" placeholder="Enhanced Matrix Computation">
                    </div>
                    <button id="start-enhanced-matrix" class="enhanced">Start Enhanced Matrix</button>
                </div>
                <div class="log-container" id="admin-log-enhanced-matrix">Enhanced matrix actions will be logged here...</div>
            </div>

            <!-- Advanced Workload Creation -->
            <div class="card">
                <h4>‚ö° Advanced Workload Creation</h4>
                <p>Create custom workloads with pluggable chunking and assembly strategies:</p>

                <div class="enhanced-controls">
                    <div>
                        <label for="advanced-framework">Framework:</label>
                        <select id="advanced-framework">
                            <option value="webgpu" selected>WebGPU</option>
                            <option value="webgl">WebGL</option>
                            <option value="cuda">CUDA</option>
                            <option value="opencl">OpenCL</option>
                            <option value="vulkan">Vulkan</option>
                        </select>
                    </div>
                    <div>
                        <label for="advanced-label">Workload Label:</label>
                        <input type="text" id="advanced-label" placeholder="Custom Advanced Workload">
                    </div>
                </div>

                <div class="enhanced-controls">
                    <div>
                        <label for="chunking-strategy">Chunking Strategy:</label>
                        <select id="chunking-strategy">
                            <option value="linear">Linear</option>
                            <option value="matrix_tiled">Matrix Tiled</option>
                            <option value="custom">Custom (from dropdown)</option>
                        </select>
                    </div>
                    <div>
                        <label for="assembly-strategy">Assembly Strategy:</label>
                        <select id="assembly-strategy">
                            <option value="linear_assembly">Linear Assembly</option>
                            <option value="matrix_tiled_assembly">Matrix Tiled Assembly</option>
                            <option value="custom">Custom (from dropdown)</option>
                        </select>
                    </div>
                </div>

                <div class="enhanced-controls">
                    <div style="flex-grow: 1;">
                        <label for="advanced-kernel">Kernel Source:</label>
                        <textarea id="advanced-kernel" placeholder="@compute @workgroup_size(64) fn main(@builtin(global_invocation_id) id: vec3<u32>) {
  // Your custom kernel code here
}" rows="8"></textarea>
                    </div>
                </div>

                <div class="enhanced-controls">
                    <div style="flex-grow: 1;">
                        <label for="advanced-metadata">Strategy Metadata (JSON):</label>
                        <textarea id="advanced-metadata" placeholder='{"elementSize": 4, "chunkSize": 1024}' rows="4"></textarea>
                    </div>
                </div>

                <div class="multi-input-section">
                    <h4>üîó Multi-Input Support</h4>
                    <div class="enhanced-controls">
                        <div>
                            <label for="input-format">Input Format:</label>
                            <select id="input-format">
                                <option value="binary">Single Binary Input</option>
                                <option value="json">Multi-Input JSON</option>
                            </select>
                        </div>
                    </div>
                    <div class="enhanced-controls">
                        <div style="flex-grow: 1;">
                            <label for="advanced-input-data">Input Data:</label>
                            <textarea id="advanced-input-data" placeholder='For binary: base64-encoded data
For multi-input JSON:
{
  "image_a": "base64-data...",
  "image_b": "base64-data...",
  "parameters": {"blend_mode": "multiply"}
}' rows="6"></textarea>
                        </div>
                    </div>
                </div>

                <div style="margin-top: 20px;">
                    <button id="create-advanced-workload" class="enhanced">Create Advanced Workload</button>
                    <button id="validate-advanced-workload" class="secondary">Validate Configuration</button>
                </div>
                <div class="log-container" id="admin-log-advanced">Advanced workload actions will be logged here...</div>
            </div>
        </div>

        <div class="card">
            <h3>System Parameters</h3>
            <div class="admin-controls">
                <div>
                    <label for="admin-k-value">Redundancy Factor (K):</label>
                    <input type="number" id="admin-k-value" value="1" min="1" step="1" style="width: 80px;">
                </div>
                <button id="set-k-button" class="secondary">Set K</button>
            </div>
            Current K: <span id="current-k-display">1</span>
            <div class="log-container" id="admin-log-system">System admin actions logged here...</div>
        </div>

        <div class="card">
            <h3>Multi-Framework Compute Workload</h3>
            <p>Create and dispatch custom compute workloads across different frameworks:</p>

            <!-- Framework Selection -->
            <div class="wgsl-controls">
                <div>
                    <label for="compute-framework">Computing Framework:</label>
                    <select id="compute-framework">
                        <option value="webgpu" selected>WebGPU (.wgsl)</option>
                        <option value="webgl">WebGL (.glsl)</option>
                        <option value="cuda">CUDA (.cu)</option>
                        <option value="opencl">OpenCL (.cl)</option>
                        <option value="vulkan">Vulkan (.comp)</option>
                    </select>
                </div>
                <div><label for="compute-label">Workload Label:</label><input type="text" id="compute-label" placeholder="e.g., Vector Processing"></div>
                <div><label for="compute-entry-point">Entry Point:</label><input type="text" id="compute-entry-point" value="main"></div>
            </div>

            <!-- Generic Kernel Source -->
            <div class="wgsl-controls">
                <div style="flex-grow: 1;">
                    <label for="compute-kernel-src">Kernel Source Code:</label>
                    <textarea id="compute-kernel-src" placeholder="Enter your kernel/shader source code here..."></textarea>
                </div>
            </div>

            <!-- Framework-specific options -->
            <div id="framework-webgpu" class="framework-options active">
                <h4>WebGPU Options</h4>
                <p>Standard WebGPU compute shader with storage buffers.</p>
            </div>

            <div id="framework-webgl" class="framework-options">
                <h4>WebGL Options</h4>
                <p>WebGL compute using transform feedback or compute shaders.</p>
                <div class="compilation-options">
                    <label>WebGL-Specific Options:</label>
                    <textarea placeholder='{"useComputeShaders": true, "version": "300 es"}'></textarea>
                </div>
            </div>

            <div id="framework-cuda" class="framework-options">
                <h4>CUDA Options</h4>
                <p>CUDA kernels executed on GPU via native client.</p>
                <div class="compilation-options">
                    <label>CUDA Compilation Options:</label>
                    <textarea placeholder='{"deviceId": 0, "computeCapability": "7.5", "optimization": "-O3"}'></textarea>
                </div>
            </div>

            <div id="framework-opencl" class="framework-options">
                <h4>OpenCL Options</h4>
                <p>OpenCL kernels for heterogeneous computing.</p>
                <div class="compilation-options">
                    <label>OpenCL Compilation Options:</label>
                    <textarea placeholder='{"deviceType": "GPU", "platform": 0, "buildOptions": "-cl-fast-relaxed-math"}'></textarea>
                </div>
            </div>

            <div id="framework-vulkan" class="framework-options">
                <h4>Vulkan Options</h4>
                <p>Vulkan compute shaders with explicit resource management.</p>
                <div class="compilation-options">
                    <label>Vulkan Compilation Options:</label>
                    <textarea placeholder='{"spirvVersion": "1.5", "vulkanVersion": "1.2", "optimizationLevel": 2}'></textarea>
                </div>
            </div>

            <!-- Common workload parameters -->
            <div class="wgsl-controls">
                <div><label for="compute-groups-x">Workgroups X:</label><input type="number" id="compute-groups-x" value="1" min="1"></div>
                <div><label for="compute-groups-y">Workgroups Y:</label><input type="number" id="compute-groups-y" value="1" min="1"></div>
                <div><label for="compute-groups-z">Workgroups Z:</label><input type="number" id="compute-groups-z" value="1" min="1"></div>
            </div>

            <div class="wgsl-controls">
                <div><label for="compute-output-size">Total Output Buffer Size (bytes):</label><input type="number" id="compute-output-size" placeholder="e.g., 4096"></div>
                <div style="flex-grow: 1;">
                    <label for="compute-input-data">Input Data (Base64):</label>
                    <textarea id="compute-input-data" placeholder="Base64 encoded binary input data..." rows="3"></textarea>
                </div>
            </div>

            <!-- Chunking options -->
            <div class="wgsl-controls">
                <div>
                    <label for="compute-chunkable" style="flex-direction: row; align-items: center;">
                        <input type="checkbox" id="compute-chunkable" style="margin-right: 5px;">Enable Chunking
                    </label>
                </div>
            </div>

            <fieldset class="wgsl-chunking-options" id="compute-chunking-options-fieldset" style="display:none;">
                <legend>Chunking Parameters</legend>
                <div class="wgsl-chunking-controls">
                    <div>
                        <label for="compute-chunk-processing-type">Chunk Type:</label>
                        <select id="compute-chunk-processing-type">
                            <option value="elements" selected>Elements</option>
                            <option value="bytes">Bytes</option>
                        </select>
                    </div>
                    <div>
                        <label for="compute-input-chunk-size">Input Chunk Size:</label>
                        <input type="number" id="compute-input-chunk-size" value="1024">
                    </div>
                    <div>
                        <label for="compute-chunk-output-size">Output Size Per Chunk (bytes):</label>
                        <input type="number" id="compute-chunk-output-size" placeholder="e.g., 512">
                    </div>
                    <div id="compute-element-size-bytes-container">
                        <label for="compute-input-element-size-bytes">Element Size (bytes):</label>
                        <input type="number" id="compute-input-element-size-bytes" value="4">
                    </div>
                    <div>
                        <label for="compute-output-aggregation-method">Output Aggregation:</label>
                        <select id="compute-output-aggregation-method">
                            <option value="concatenate" selected>Concatenate</option>
                        </select>
                    </div>
                </div>
            </fieldset>

            <!-- Action buttons -->
            <div style="margin-top: 20px;">
                <button id="push-compute-workload">Create Workload</button>
                <button id="start-queued-compute-button" class="secondary">Start All Queued</button>
            </div>

            <div class="log-container" id="admin-log-wgsl">Compute workload actions will be logged here...</div>
        </div>

        <div class="card">
            <h3>Active Compute Workloads</h3>
            <div class="wgsl-grid" id="active-wgsl-workloads-grid">
                <p>No compute workloads active.</p>
            </div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="client.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const secureContextStatus = document.getElementById('secure-context-status');
            if (window.isSecureContext) {
                secureContextStatus.textContent = 'Running in a secure context (HTTPS or localhost) - All frameworks can be used.';
                secureContextStatus.className = 'status success';
            } else {
                secureContextStatus.innerHTML = 'Not running in a secure context. WebGPU/WebGL require HTTPS or localhost. <a href="https://' + window.location.host + window.location.pathname + '">Try HTTPS</a>';
                secureContextStatus.className = 'status error';
            }

            // Framework-specific UI handling
            const frameworkSelect = document.getElementById('compute-framework');
            const frameworkOptions = document.querySelectorAll('.framework-options');
            const entryPointInput = document.getElementById('compute-entry-point');
            const kernelTextarea = document.getElementById('compute-kernel-src');

            // Framework-specific defaults
            const frameworkDefaults = {
                webgpu: { entry: 'main', placeholder: '@compute @workgroup_size(64) fn main(@builtin(global_invocation_id) id: vec3<u32>) {\n  // WebGPU compute shader\n}' },
                webgl: { entry: 'main', placeholder: '#version 300 es\n// WebGL compute shader\nvoid main() {\n  // GLSL code\n}' },
                cuda: { entry: 'kernel', placeholder: '__global__ void kernel(float* input, float* output, int n) {\n  // CUDA kernel\n}' },
                opencl: { entry: 'kernel', placeholder: '__kernel void kernel(__global float* input, __global float* output) {\n  // OpenCL kernel\n}' },
                vulkan: { entry: 'main', placeholder: '#version 450\nlayout(local_size_x = 64) in;\n// Vulkan compute shader\nvoid main() {\n  // GLSL compute\n}' }
            };

            frameworkSelect.addEventListener('change', function() {
                const selectedFramework = this.value;

                // Hide all framework options
                frameworkOptions.forEach(option => {
                    option.classList.remove('active');
                });

                // Show selected framework options
                const activeOption = document.getElementById(`framework-${selectedFramework}`);
                if (activeOption) {
                    activeOption.classList.add('active');
                }

                // Update entry point and placeholder
                const defaults = frameworkDefaults[selectedFramework];
                if (defaults) {
                    entryPointInput.value = defaults.entry;
                    kernelTextarea.placeholder = defaults.placeholder;
                }
            });

            // Chunking options toggle
            const chunkableCheckbox = document.getElementById('compute-chunkable');
            const chunkingOptionsDiv = document.getElementById('compute-chunking-options-fieldset');
            const chunkProcessingTypeSelect = document.getElementById('compute-chunk-processing-type');
            const elementSizeBytesContainer = document.getElementById('compute-element-size-bytes-container');

            chunkableCheckbox.addEventListener('change', function() {
                chunkingOptionsDiv.style.display = this.checked ? 'block' : 'none';
                if (this.checked) {
                    elementSizeBytesContainer.style.display = chunkProcessingTypeSelect.value === 'elements' ? 'flex' : 'none';
                } else {
                    elementSizeBytesContainer.style.display = 'none';
                }
            });

            chunkProcessingTypeSelect.addEventListener('change', function() {
                if (chunkableCheckbox.checked) {
                    elementSizeBytesContainer.style.display = this.value === 'elements' ? 'flex' : 'none';
                }
            });

            // Initialize with WebGPU defaults
            frameworkSelect.dispatchEvent(new Event('change'));

            // Enhanced chunking system handlers

            // Strategy management
            document.getElementById('list-strategies-btn').addEventListener('click', async () => {
                logEnhancedActivity('Loading available strategies...', 'strategies');
                try {
                    const res = await fetch('/api/strategies');
                    const data = await res.json();
                    displayAvailableStrategies(data);
                    logEnhancedActivity('‚úÖ Strategies loaded successfully', 'strategies', 'success');
                } catch (err) {
                    logEnhancedActivity('‚ùå Failed to load strategies: ' + err.message, 'strategies', 'error');
                }
            });

            document.getElementById('upload-strategy-btn').addEventListener('click', async () => {
                const type = document.getElementById('strategy-type').value;
                const name = document.getElementById('strategy-name').value;
                const code = document.getElementById('strategy-code').value;

                if (!name || !code) {
                    alert('Strategy name and code are required');
                    return;
                }

                logEnhancedActivity(`Uploading ${type} strategy "${name}"...`, 'strategies');
                try {
                    const res = await fetch('/api/strategies/register', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ strategyCode: code, type, name })
                    });
                    const result = await res.json();

                    if (res.ok && result.success) {
                        logEnhancedActivity(`‚úÖ Strategy "${name}" uploaded successfully`, 'strategies', 'success');
                        // Clear the form
                        document.getElementById('strategy-name').value = '';
                        document.getElementById('strategy-code').value = '';
                        // Refresh strategies list
                        document.getElementById('list-strategies-btn').click();
                    } else {
                        logEnhancedActivity(`‚ùå Upload failed: ${result.error}`, 'strategies', 'error');
                    }
                } catch (err) {
                    logEnhancedActivity('‚ùå Network error: ' + err.message, 'strategies', 'error');
                }
            });

            // Enhanced tiled matrix
            document.getElementById('start-enhanced-matrix').addEventListener('click', async () => {
                const matrixSize = parseInt(document.getElementById('enhanced-matrix-size').value);
                const tileSize = parseInt(document.getElementById('tile-size').value);
                const label = document.getElementById('enhanced-matrix-label').value ||
                    `Enhanced Matrix ${matrixSize}√ó${matrixSize} (${tileSize}√ó${tileSize} tiles)`;

                logEnhancedActivity(`Starting enhanced tiled matrix: ${matrixSize}√ó${matrixSize}, tiles: ${tileSize}√ó${tileSize}...`, 'enhanced-matrix');

                try {
                    const res = await fetch('/api/matrix/tiled-advanced', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ matrixSize, tileSize, label })
                    });
                    const result = await res.json();

                    if (res.ok && result.success) {
                        logEnhancedActivity(`‚úÖ ${result.message} (ID: ${result.id.substring(0,6)})`, 'enhanced-matrix', 'success');
                    } else {
                        logEnhancedActivity(`‚ùå Failed: ${result.error}`, 'enhanced-matrix', 'error');
                    }
                } catch (err) {
                    logEnhancedActivity('‚ùå Network error: ' + err.message, 'enhanced-matrix', 'error');
                }
            });

            // Advanced workload creation
            document.getElementById('create-advanced-workload').addEventListener('click', async () => {
                const framework = document.getElementById('advanced-framework').value;
                const label = document.getElementById('advanced-label').value || 'Custom Advanced Workload';
                const chunkingStrategy = document.getElementById('chunking-strategy').value;
                const assemblyStrategy = document.getElementById('assembly-strategy').value;
                const kernel = document.getElementById('advanced-kernel').value;
                const metadataText = document.getElementById('advanced-metadata').value;
                const inputData = document.getElementById('advanced-input-data').value;

                if (!kernel || !metadataText || !inputData) {
                    alert('Kernel source, metadata, and input data are required');
                    return;
                }

                let metadata;
                try {
                    metadata = JSON.parse(metadataText);
                } catch (e) {
                    alert('Invalid metadata JSON: ' + e.message);
                    return;
                }

                const payload = {
                    label,
                    chunkingStrategy,
                    assemblyStrategy,
                    framework,
                    input: inputData,
                    metadata: {
                        ...metadata,
                        customShader: kernel
                    }
                };

                logEnhancedActivity(`Creating advanced workload "${label}" with ${chunkingStrategy}/${assemblyStrategy}...`, 'advanced');

                try {
                    const res = await fetch('/api/workloads/advanced', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    const result = await res.json();

                    if (res.ok && result.success) {
                        logEnhancedActivity(`‚úÖ ${result.message} (ID: ${result.id.substring(0,6)})`, 'advanced', 'success');
                    } else {
                        logEnhancedActivity(`‚ùå Failed: ${result.error}`, 'advanced', 'error');
                    }
                } catch (err) {
                    logEnhancedActivity('‚ùå Network error: ' + err.message, 'advanced', 'error');
                }
            });

            document.getElementById('validate-advanced-workload').addEventListener('click', () => {
                const metadataText = document.getElementById('advanced-metadata').value;
                try {
                    JSON.parse(metadataText);
                    logEnhancedActivity('‚úÖ Configuration is valid', 'advanced', 'success');
                } catch (e) {
                    logEnhancedActivity('‚ùå Invalid metadata JSON: ' + e.message, 'advanced', 'error');
                }
            });

            // Traditional workload creation
            document.getElementById('push-compute-workload').addEventListener('click', async () => {
                const framework = frameworkSelect.value;
                const chunkable = chunkableCheckbox.checked;

                // Get framework-specific compilation options
                const activeFrameworkOption = document.querySelector('.framework-options.active');
                const compilationOptsTextarea = activeFrameworkOption?.querySelector('textarea');
                let compilationOptions = {};

                if (compilationOptsTextarea && compilationOptsTextarea.value.trim()) {
                    try {
                        compilationOptions = JSON.parse(compilationOptsTextarea.value);
                    } catch (e) {
                        alert('Invalid JSON in compilation options: ' + e.message);
                        return;
                    }
                }

                const payload = {
                    label: document.getElementById('compute-label').value || 'Untitled Workload',
                    framework: framework,
                    kernel: document.getElementById('compute-kernel-src').value,
                    entry: document.getElementById('compute-entry-point').value || 'main',
                    workgroupCount: [
                        +document.getElementById('compute-groups-x').value || 1,
                        +document.getElementById('compute-groups-y').value || 1,
                        +document.getElementById('compute-groups-z').value || 1
                    ],
                    outputSize: +document.getElementById('compute-output-size').value,
                    input: document.getElementById('compute-input-data').value || undefined,
                    chunkable: chunkable,
                    compilationOptions: compilationOptions
                };

                if (chunkable) {
                    const chunkOutputSize = +document.getElementById('compute-chunk-output-size').value;
                    if (!chunkOutputSize || chunkOutputSize <= 0) {
                        alert('Chunk Output Size is required and must be > 0 for chunkable workloads');
                        return;
                    }

                    payload.inputChunkProcessingType = document.getElementById('compute-chunk-processing-type').value;
                    payload.inputChunkSize = +document.getElementById('compute-input-chunk-size').value;
                    payload.chunkOutputSize = chunkOutputSize;
                    payload.inputElementSizeBytes = +document.getElementById('compute-input-element-size-bytes').value;
                    payload.outputAggregationMethod = document.getElementById('compute-output-aggregation-method').value;
                }

                logAdminActivity(`Creating ${framework.toUpperCase()} workload "${payload.label}"...`, 'wgsl');

                try {
                    const res = await fetch('/api/workloads', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    const j = await res.json();

                    if (res.ok && j.ok) {
                        logAdminActivity(`‚úÖ ID ${j.id.substring(0,6)}: ${j.message}`, 'wgsl', 'success');
                    } else {
                        logAdminActivity(`‚ùå Error: ${j.error || res.statusText}`, 'wgsl', 'error');
                    }
                } catch (err) {
                    logAdminActivity(`‚ùå Network error: ${err.message}`, 'wgsl', 'error');
                }
            });

            // Start queued workloads
            document.getElementById('start-queued-compute-button').addEventListener('click', () => {
                logAdminActivity('Starting all queued compute workloads...', 'wgsl');
                if (typeof socket !== 'undefined') {
                    socket.emit('admin:startQueuedCustomWorkloads');
                }
            });

            // Helper functions for enhanced logging
            function logEnhancedActivity(message, section, level = 'info') {
                const logId = `admin-log-${section}`;
                const logElement = document.getElementById(logId);
                if (logElement) {
                    const timestamp = new Date().toLocaleTimeString();
                    const levelIcon = {
                        'info': 'üìã',
                        'success': '‚úÖ',
                        'error': '‚ùå',
                        'warning': '‚ö†Ô∏è'
                    }[level] || 'üìã';

                    logElement.innerHTML += `\n[${timestamp}] ${levelIcon} ${message}`;
                    logElement.scrollTop = logElement.scrollHeight;
                }
            }

            function displayAvailableStrategies(data) {
                const container = document.getElementById('available-strategies');
                if (!data.available || Object.keys(data.available).length === 0) {
                    container.innerHTML = '<div class="strategy-card"><h4>No strategies loaded</h4><p>Upload custom strategies or check server configuration</p></div>';
                    return;
                }

                let html = '';
                for (const [name, strategy] of Object.entries(data.available)) {
                    const type = strategy.type || 'unknown';
                    const description = strategy.description || 'No description available';

                    html += `
                        <div class="strategy-card">
                            <div class="strategy-type ${type}">${type}</div>
                            <h4>${name}</h4>
                            <p>${description}</p>
                            <div style="font-size: 0.8em; color: #666; margin-top: 5px;">
                                Loaded: ${new Date(strategy.loadedAt || Date.now()).toLocaleString()}
                            </div>
                        </div>
                    `;
                }

                container.innerHTML = html;

                // Update strategy dropdowns
                updateStrategyDropdowns(data.available);
            }

            function updateStrategyDropdowns(strategies) {
                const chunkingSelect = document.getElementById('chunking-strategy');
                const assemblySelect = document.getElementById('assembly-strategy');

                // Clear existing custom options
                Array.from(chunkingSelect.options).forEach(option => {
                    if (option.value.startsWith('custom_')) {
                        option.remove();
                    }
                });
                Array.from(assemblySelect.options).forEach(option => {
                    if (option.value.startsWith('custom_')) {
                        option.remove();
                    }
                });

                // Add loaded strategies
                for (const [name, strategy] of Object.entries(strategies)) {
                    if (strategy.type === 'chunking') {
                        const option = new Option(name, name);
                        chunkingSelect.add(option);
                    } else if (strategy.type === 'assembly') {
                        const option = new Option(name, name);
                        assemblySelect.add(option);
                    }
                }
            }
        });
    </script>
</body>
</html>